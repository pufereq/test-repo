name: Bump version

on:
  workflow_dispatch:
    inputs:
      version:
        type: string
        description: 'new version'
        required: true


env:
  GH_TOKEN: ${{ secrets.GH_TOKEN }}

jobs:
  create_version:
    runs-on: ubuntu-latest
    name: Create version from tag
    steps:
      - name: GH_TOKEN
        if: env.GH_TOKEN == ''
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: echo "GH_TOKEN=${GITHUB_TOKEN}" >> $GITHUB_ENV
      - name: 🔀 checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: "${{ env.GH_TOKEN }}"
      - name: 🐍 python
        uses: actions/setup-python@v2
        with:
          python-version: 3.11
          cache: pip
      - name: node
        uses: actions/setup-node@v2
        continue-on-error: true
        with:
          node-version: 16
          cache: npm
      - name: 📦 install commitizen and release-it
        run: |
          pip install bump2version --break-system-packages
          npm install -g release-it
      - name: 📝 bump version and release
        run: release-it ${{ github.event.inputs.version }}
      - name: ✅ done
        run: echo "Release created"
